---
import Layout from "../layouts/Layout.astro";
import PublicHeader from "@/components/navigation/PublicHeader";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import ScreenshotImage from "@/components/ScreenshotImage.astro";

export const prerender = false;

// Check if user is logged in (will work after middleware implementation)
const user = Astro.locals.user;
---

<Layout>
  <PublicHeader client:load currentPath={Astro.url.pathname} />

  <div class="container mx-auto px-4 py-8">
    {
      user ? (
        <div class="text-center space-y-4 mb-8">
          <p class="text-muted-foreground">Jeste zalogowany jako: {user.email}</p>
          <a
            href="/dashboard"
            class="inline-flex items-center justify-center rounded-md text-sm font-medium h-10 px-6 bg-primary text-primary-foreground hover:bg-primary/90"
          >
            Przejd藕 do Dashboard
          </a>
        </div>
      ) : (
        <>
          {/* Hero Section */}
          <section class="text-center space-y-4 mb-12 py-8">
            <h1 class="text-4xl md:text-5xl font-bold tracking-tight">Witaj w PriceHistory</h1>
            <p class="text-lg md:text-xl text-muted-foreground max-w-2xl mx-auto">
              Automatycznie led藕 zmiany cen ogosze samochodowych na Otomoto.pl. Podejmuj wiadome decyzje zakupowe
              dziki penej historii cenowej.
            </p>
            <div class="flex gap-4 justify-center flex-wrap mt-6">
              <Button asChild size="lg">
                <a href="/register">Zacznij za darmo</a>
              </Button>
              <Button asChild size="lg" variant="outline">
                <a href="/login">Zaloguj si</a>
              </Button>
            </div>
          </section>

          {/* App Description & How It Works */}
          <section class="mb-12">
            <Card>
              <CardHeader>
                <CardTitle class="text-2xl">Czym jest PriceHistory?</CardTitle>
                <CardDescription>
                  PriceHistory rozwizuje problem braku dostpu do historii cen ofert na Otomoto.pl. System
                  automatycznie monitoruje wybrane oferty, zapisuje histori cen i wizualizuje zmiany na interaktywnych
                  wykresach.
                </CardDescription>
              </CardHeader>
              <CardContent class="space-y-6">
                <div class="grid md:grid-cols-2 gap-4">
                  <div>
                    <h3 class="font-semibold mb-2">1. Dodaj ofert</h3>
                    <p class="text-sm text-muted-foreground">
                      Wklej URL oferty z Otomoto.pl. System automatycznie pobiera stron, ekstrahuje dane przy u偶yciu AI
                      (tytu, cena, zdjcie, lokalizacja) i rozpoczyna monitorowanie.
                    </p>
                  </div>
                  <div>
                    <h3 class="font-semibold mb-2">2. Automatyczne monitorowanie</h3>
                    <p class="text-sm text-muted-foreground">
                      System regularnie sprawdza ceny w konfigurowalnych interwaach (6h, 12h, 24h, 48h), ekstrahuje
                      ceny przy u偶yciu zapisanych selektor贸w CSS lub AI jako fallback i zapisuje wyniki w historii.
                    </p>
                  </div>
                  <div>
                    <h3 class="font-semibold mb-2">3. Historia i wizualizacja</h3>
                    <p class="text-sm text-muted-foreground">
                      Ka偶da zmiana ceny jest zapisywana z datami sprawdze. Na dashboardzie znajdziesz interaktywne
                      wykresy, statystyki (min, max, rednia, trend) i kolorowe oznaczenia zmian cen.
                    </p>
                  </div>
                  <div>
                    <h3 class="font-semibold mb-2">Kluczowe funkcje</h3>
                    <ul class="text-sm text-muted-foreground space-y-1">
                      <li>- AI-powered ekstrakcja danych (GPT-4o-mini, Claude Haiku)</li>
                      <li>- Wykrywanie anomalii cenowych (&gt;50% zmiana)</li>
                      <li>- Historia przechowywana przez 30 dni (darmowy plan)</li>
                      <li>- Limit 5 ofert jednoczenie (darmowy plan)</li>
                    </ul>
                  </div>
                </div>
              </CardContent>
            </Card>
          </section>

          {/* Screenshots Section */}
          <section class="mb-12">
            <h2 class="text-2xl font-bold text-center mb-6">Zobacz jak to wyglda</h2>
            <div class="grid md:grid-cols-2 gap-6">
              <Card>
                <CardHeader>
                  <CardTitle>Dashboard</CardTitle>
                  <CardDescription>Przegld wszystkich obserwowanych ofert</CardDescription>
                </CardHeader>
                <CardContent>
                  <ScreenshotImage
                    src="/screenshots/dashboard.png"
                    alt="Zrzut ekranu dashboardu PriceHistory"
                    placeholderText=" Zrzut ekranu dashboardu (Dodaj screenshot: /public/screenshots/dashboard.png)"
                  />
                </CardContent>
              </Card>

              <Card>
                <CardHeader>
                  <CardTitle>Szczeg贸y oferty</CardTitle>
                  <CardDescription>Historia cen i wykresy</CardDescription>
                </CardHeader>
                <CardContent>
                  <ScreenshotImage
                    src="/screenshots/offer-details.png"
                    alt="Zrzut ekranu strony szczeg贸贸w oferty"
                    placeholderText=" Zrzut ekranu strony szczeg贸贸w (Dodaj screenshot: /public/screenshots/offer-details.png)"
                  />
                </CardContent>
              </Card>
            </div>
          </section>

          {/* CTA Section */}
          <section class="text-center py-8 bg-muted rounded-lg">
            <h2 class="text-2xl font-bold mb-3">Gotowy, aby zacz?</h2>
            <p class="text-base text-muted-foreground mb-6 max-w-xl mx-auto">
              Docz do u偶ytkownik贸w PriceHistory i zacznij ledzi zmiany cen ofert samochodowych ju偶 dzi.
            </p>
            <div class="flex gap-4 justify-center flex-wrap">
              <Button asChild size="lg">
                <a href="/register">Zarejestruj si za darmo</a>
              </Button>
              <Button asChild size="lg" variant="outline">
                <a href="/login">Masz ju偶 konto? Zaloguj si</a>
              </Button>
            </div>
          </section>
        </>
      )
    }
  </div>
</Layout>
